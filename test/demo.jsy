import TestHub from './_test_hub.jsy'

main().catch @ console.error

async function main() ::
  const hub = new TestHub()

  const tgt_ping = hub.endpoint @ ep_ping
  const tgt_pong = hub.endpoint @ ep_pong

  async function ep_ping(ep, msg, pkt) ::
    if undefined === msg ::
      console.log @ 'PING initializeed', @: tgt_ping, tgt_pong
      console.log @ 'PING sending "hello"'
      ep.to(tgt_pong, {token: 1942})
        .send @: say: 'hello'
      return

    console.log()
    console.log @ 'PING recv:', msg
    console.log()

  async function ep_pong(ep, msg, pkt) ::
    if undefined === msg ::
      console.log @ 'PONG initializeed', @: tgt_ping, tgt_pong
      return

    console.log()
    console.log @ 'PONG recv:', msg
    console.log @ 'PONG sending "salut"'
    ep.to(msg.info)
      .send @: reply: 'salut'
    console.log()
